<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>โน็ตบันทึกชั่วโมงOT รอบวันที่16-15</title>
<style>
* { box-sizing: border-box; }
body { font-family: Arial,sans-serif; margin:5px; background:linear-gradient(135deg,#f0f4ff,#d9e8ff);}
h2{ text-align:center; color:#0d47a1; text-shadow:1px 1px 2px #aaa; margin-bottom:5px;}
.instructions{ background:#e3f2fd; border-left:4px solid #1976d2; padding:5px 10px; margin-bottom:5px; font-size:12px; line-height:1.4;}
.credit{ text-align:center; font-size:11px; color:#555; margin-bottom:5px;}
.controls{ display:flex; flex-wrap:wrap; gap:5px; align-items:center; justify-content:center; margin-bottom:5px;}
select,button{ padding:5px 8px; font-size:13px; border-radius:8px; border:1px solid #1976d2; background:linear-gradient(to bottom,#42a5f5,#1e88e5); color:white; cursor:pointer; box-shadow:2px 2px 5px rgba(0,0,0,0.2); transition:transform 0.1s;}
select:hover,button:hover{ transform:translateY(-2px);}
.checkbox-container{ display:flex; flex-wrap:wrap; justify-content:center; gap:3px; font-size:12px; margin-bottom:5px;}
.summary{ text-align:center; background:linear-gradient(to right,#a8ff78,#78ffd6); padding:5px 10px; border-radius:12px; font-weight:bold; font-size:12px; box-shadow:1px 2px 6px rgba(0,0,0,0.2); margin-bottom:10px;}
table{ width:100%; border-collapse:collapse; background:white; font-size:11px; border-radius:12px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
th,td{ border:1px solid #ddd; padding:3px; text-align:center; vertical-align:middle; transition:all 0.2s;}
th{ background:linear-gradient(to bottom,#1976d2,#42a5f5); color:white; text-shadow:1px 1px 2px #333;}
tr:hover{ background:#e3f2fd; transform:scale(1.02); box-shadow:0 4px 10px rgba(0,0,0,0.2);}
input[type="number"], input[type="text"], select{ width:100%; padding:2px; font-size:11px; border-radius:6px; border:1px solid #1976d2; box-shadow:inset 1px 1px 3px rgba(0,0,0,0.1);}
.holiday-personal{ background:#ffd3d3; border-left:4px solid #ff1744; font-weight:bold;}
.holiday-ot{ background:#fff3b2 !important; border-left:4px solid #ffc400; font-weight:bold;}
@media(max-width:480px){h2{font-size:16px;} .controls{flex-direction:column;align-items:stretch;} select,button{font-size:11px;width:100%;} .checkbox-container{font-size:10px;} .summary{font-size:11px;} th,td{font-size:10px;padding:1px;} input[type="number"],input[type="text"],select{font-size:10px;}}
.td-shift .shift-label{ font-weight:bold; margin-bottom:2px; display:block; color:#0d47a1; text-shadow:1px 1px 1px #aaa; }
.td-shift select{ border-radius:6px; border:1px solid #1976d2; appearance:none; -webkit-appearance:none; -moz-appearance:none;
background:white url('data:image/svg+xml;utf8,<svg fill="gray" height="12" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 5px center; background-size:12px 12px;}
</style>
</head>
<body>

<h2>โน็ตบันทึกชั่วโมงOT รอบวันที่16-15</h2>

<div class="instructions">
<b>วิธีใช้งาน:</b><br>
1. เลือกวันหยุดส่วนตัวที่ต้องการ<br>
2. เลือกกะ (N1, D1, HD1, HN1)<br>
3. กรอกจำนวนชั่วโมง OT (1–3 ชั่วโมง วันธรรมดา จะขึ้นหมายเหตุ "ตัดกลับ")<br>
4. ระบบคำนวณ OT1 / OT1.5 / OT3 อัตโนมัติ<br>
5. กด "ล้างข้อมูล" เพื่อรีเซ็ต<br>
6. ข้อมูลทั้งหมดบันทึกอัตโนมัติใน LocalStorage
</div>

<div class="credit">ออกแบบเว็บนี้โดย: สิทธินน</div>

<div class="controls">
เดือน: <select id="month"></select>
ปี: <select id="year"></select>
<button id="resetBtn">ล้างข้อมูล</button>
</div>

<div class="checkbox-container">
วันหยุดส่วนตัว:
<label><input type="checkbox" value="1"> จันทร์</label>
<label><input type="checkbox" value="2"> อังคาร</label>
<label><input type="checkbox" value="3"> พุธ</label>
<label><input type="checkbox" value="4"> พฤหัส</label>
<label><input type="checkbox" value="5"> ศุกร์</label>
<label><input type="checkbox" value="6"> เสาร์</label>
<label><input type="checkbox" value="0"> อาทิตย์</label>
</div>

<div class="summary" id="summary">รวม OT1:0 | OT1.5:0 | OT3:0</div>

<table id="otTable">
<thead>
<tr>
<th>วันที่</th><th>วัน</th><th>กะ</th><th>ชั่วโมง OT</th>
<th>OT1</th><th>OT1.5</th><th>OT3</th>
<th>เวลาเข้า–ออก</th><th>หมายเหตุ</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded",function(){
const dayNames=["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัส","ศุกร์","เสาร์"];
const monthSelect=document.getElementById("month");
const yearSelect=document.getElementById("year");
const tbody=document.getElementById("otTable").querySelector("tbody");
const summary=document.getElementById("summary");
const checkboxes=document.querySelectorAll(".checkbox-container input[type=checkbox]");
let userHolidays=[];

// โหลดเดือน/ปี
for(let m=0;m<12;m++){
  const opt=document.createElement("option"); opt.value=m;
  opt.text=new Date(2025,m).toLocaleString("th-TH",{month:"long"});
  monthSelect.appendChild(opt);
}
monthSelect.value=new Date().getMonth();
const currentYear=new Date().getFullYear();
for(let y=currentYear-2;y<=currentYear+2;y++){
  const opt=document.createElement("option"); opt.value=y; opt.text=y; yearSelect.appendChild(opt);
}
yearSelect.value=currentYear;

function getKeyData(){return`otData_${yearSelect.value}-${parseInt(monthSelect.value)+1}`;}
function getKeyHoliday(){return`holidays_${yearSelect.value}-${parseInt(monthSelect.value)+1}`;}

function loadHolidays(){
const saved=JSON.parse(localStorage.getItem(getKeyHoliday())||"[]");
checkboxes.forEach(cb=>cb.checked=saved.includes(parseInt(cb.value)));
userHolidays=Array.from(checkboxes).filter(cb=>cb.checked).map(cb=>parseInt(cb.value));
}
checkboxes.forEach(cb=>cb.addEventListener("change",()=>{
userHolidays=Array.from(checkboxes).filter(c=>c.checked).map(c=>parseInt(c.value));
localStorage.setItem(getKeyHoliday(),JSON.stringify(userHolidays));
createTable();
}));
document.getElementById("resetBtn").addEventListener("click",()=>{
localStorage.removeItem(getKeyData());
localStorage.removeItem(getKeyHoliday());
createTable();
});

function createTable(){
tbody.innerHTML="";
loadHolidays();
const month=parseInt(monthSelect.value);
const year=parseInt(yearSelect.value);
const startDate=new Date(year,month,16);
const endDate=new Date(year,month+1,15);
const savedData=JSON.parse(localStorage.getItem(getKeyData())||"[]");
let current=new Date(startDate);

while(current<=endDate){
const tr=document.createElement("tr");
const day=current.getDay();
const tdDate=document.createElement("td"); tdDate.textContent=current.toLocaleDateString("th-TH"); tr.appendChild(tdDate);
const tdDay=document.createElement("td"); tdDay.textContent=dayNames[day]; tr.appendChild(tdDay);

const tdShift=document.createElement("td"); tdShift.classList.add("td-shift");
const shiftLabel=document.createElement("div"); shiftLabel.classList.add("shift-label"); shiftLabel.textContent=""; tdShift.appendChild(shiftLabel);
const selectShift=document.createElement("select");
["","N1","D1","HD1","HN1"].forEach(v=>{ const opt=document.createElement("option"); opt.value=v; opt.text=v; selectShift.appendChild(opt); });
tdShift.appendChild(selectShift); tr.appendChild(tdShift);

const tdHours=document.createElement("td");
const inputHours=document.createElement("input"); inputHours.type="number"; inputHours.min=0; inputHours.max=12; inputHours.style.display="none"; tdHours.appendChild(inputHours); tr.appendChild(tdHours);

const tdOT1=document.createElement("td"), tdOT15=document.createElement("td"), tdOT3=document.createElement("td"); tr.appendChild(tdOT1); tr.appendChild(tdOT15); tr.appendChild(tdOT3);
const tdTime=document.createElement("td"); tr.appendChild(tdTime);
const tdNote=document.createElement("td"); const inputNote=document.createElement("input"); inputNote.type="text"; tdNote.appendChild(inputNote); tr.appendChild(tdNote);

if(userHolidays.includes(day)) tr.classList.add("holiday-personal");
tbody.appendChild(tr);

const idx=savedData.findIndex(d=>d.date===current.toLocaleDateString("th-TH"));
if(idx>=0){
const d=savedData[idx];
selectShift.value=d.shift; shiftLabel.textContent=d.shift;
if(d.shift) inputHours.style.display="inline-block";
inputHours.value=d.hours;
tdOT1.textContent=d.ot1||""; tdOT15.textContent=d.ot15||""; tdOT3.textContent=d.ot3||"";
tdTime.textContent=d.time||""; inputNote.value=d.note||"";
if(d.shift=="HD1"||d.shift=="HN1"){ tr.classList.remove("holiday-personal"); tr.classList.add("holiday-ot"); }
}

selectShift.addEventListener("change",()=>{
shiftLabel.textContent=selectShift.value;
if(selectShift.value){ inputHours.style.display="inline-block"; } else { inputHours.style.display="none"; inputHours.value=""; }
if(selectShift.value=="HD1"||selectShift.value=="HN1"){ tr.classList.remove("holiday-personal"); tr.classList.add("holiday-ot"); inputNote.value="OT วันหยุด"; }
else if(userHolidays.includes(day)){ tr.classList.add("holiday-personal"); tr.classList.remove("holiday-ot"); inputNote.value=""; }
else{ tr.classList.remove("holiday-personal","holiday-ot"); inputNote.value=""; }
});

inputHours.addEventListener("input",()=>{ updateRow(tr,selectShift,inputHours,current); });
current.setDate(current.getDate()+1);
}
updateSummary();
}

function updateRow(tr,selectShift,inputHours,current){
const tds=tr.querySelectorAll("td");
const shift=selectShift.value;
const hours=parseFloat(inputHours.value||0);
const tdOT1=tds[4], tdOT15=tds[5], tdOT3=tds[6], tdTime=tds[7], tdNote=tds[8].querySelector("input");
let ot1=0, ot15=0, ot3=0, startTime="";
if(hours>0){
if(shift=="N1"||shift=="D1"){ ot15=hours; startTime=(shift=="N1")?"03:45":"15:45"; tdNote.value=(hours>0 && hours<=3)?"ตัดกลับ":""; }
else if(shift=="HD1"||shift=="HN1"){ startTime=(shift=="HD1")?"07:45":"19:45"; if(hours<=8){ot1=hours;} else {ot1=8; ot3=hours-8;} tdNote.value="OT วันหยุด"; }
tdTime.textContent=`${startTime} – ${addHours(startTime,hours)}`;
} else { tdOT1.textContent=""; tdOT15.textContent=""; tdOT3.textContent=""; tdTime.textContent=""; tdNote.value=""; }
tdOT1.textContent=ot1?ot1.toFixed(2):"";
tdOT15.textContent=ot15?ot15.toFixed(2):"";
tdOT3.textContent=ot3?ot3.toFixed(2):"";
saveData(); updateSummary();
}

function addHours(start,h){ let [hh,mm]=start.split(":").map(Number); hh+=h; if(hh>=24) hh-=24; return `${hh.toString().padStart(2,'0')}:${mm.toString().padStart(2,'0')}`; }

function updateSummary(){
let ot1=0,ot15=0,ot3=0;
tbody.querySelectorAll("tr").forEach(tr=>{ ot1+=parseFloat(tr.cells[4].textContent||0); ot15+=parseFloat(tr.cells[5].textContent||0); ot3+=parseFloat(tr.cells[6].textContent||0); });
summary.textContent=`รวม OT1:${ot1} | OT1.5:${ot15} | OT3:${ot3}`;
}

function saveData(){
const data=[];
tbody.querySelectorAll("tr").forEach(tr=>{
const date=tr.cells[0].textContent;
const shift=tr.cells[2].querySelector("select").value;
const hours=parseFloat(tr.cells[3].querySelector("input").value||0);
const ot1=tr.cells[4].textContent;
const ot15=tr.cells[5].textContent;
const ot3=tr.cells[6].textContent;
const time=tr.cells[7].textContent;
const note=tr.cells[8].querySelector("input").value;
data.push({date,shift,hours,ot1,ot15,ot3,time,note});
});
localStorage.setItem(getKeyData(),JSON.stringify(data));
}

monthSelect.addEventListener("change",createTable);
yearSelect.addEventListener("change",createTable);
createTable();
});
</script>

</body>
</html>
